{% extends "blog/base.html" %}

{% block title %}{{ content.title }}{% endblock %}

{% block content %}
    <p><a href="{% url 'feed' %}{% if feed_page %}?page={{ feed_page }}{% endif %}">Back to feed</a></p>
    {% if content.author == request.user.author %}
        <a href="{% url 'update' slug=content.slug %}">Edit</a>
    {% endif %}
    <h1>{{ content.title }}</h1>
    <p>Published on {{ content.date_time_create }} by {{ content.author }}</p>
    <p>{{ content.text|safe }}</p>
    {% if content.author == request.user.author and content.is_published %}
        <a href="{% url 'unpublish' slug=content.slug %}?next={{ request.path }}">Unpublish</a>
    {% elif content.author == request.user.author and not content.is_published %}
        <a href="{% url 'publish' slug=content.slug %}?next={{ request.path }}">Publish</a>
    {% endif %}

    {% if comments %}
        <h2>Comments:</h2>
        <p>{{ comments_count }} comment{{ comments_count|pluralize }}</p>
        <ul>
        {% for comment in comments %}
            <li>
                <p>{{ comment.text }}</p>
                <p>Published on {{ comment.date_time_create }} by {{ comment.author }}</p>
                {% if request.user.is_authenticated and comment.author == request.user.author %}
                <button onclick="location.href='{% url 'delete_comment' pk=comment.pk slug=content.slug %}?page={{ feed_page }}'">Delete</button>
                {% endif %}
            </li>
        {% empty %}
            <p>No comments yet.</p>
        {% endfor %}
        </ul>
    {% endif %}

    <h2>Add Comment:</h2>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Submit</button>
    </form>

{% endblock %}